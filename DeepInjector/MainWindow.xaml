<Window x:Class="DeepInjector.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:DeepInjector"
        mc:Ignorable="d"
        Title="Deep Injector" 
        Height="320" 
        Width="550" 
        WindowStartupLocation="CenterScreen"
        Foreground="{StaticResource TextPrimaryBrush}"
        FontFamily="{StaticResource Rubik}"
        FontSize="11"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="NoResize"
        BorderThickness="0"
        RenderOptions.BitmapScalingMode="HighQuality"
        TextOptions.TextRenderingMode="ClearType"
        TextOptions.TextHintingMode="Animated"
        UseLayoutRounding="True"
        Loaded="Window_Loaded">
    <Window.Clip>
        <RectangleGeometry Rect="0,0,550,320" RadiusX="15" RadiusY="15" x:Name="WindowRect"/>
    </Window.Clip>

    <Window.Template>
        <ControlTemplate TargetType="{x:Type Window}">
            <Border x:Name="WindowBorder" 
                    BorderThickness="0"
                    BorderBrush="{StaticResource GlassBorderBrush}"
                    Background="{StaticResource WindowBackgroundBrush}"
                    CornerRadius="8">
                <Border.Effect>
                    <DropShadowEffect Color="Black" Direction="0" ShadowDepth="0" BlurRadius="15" Opacity="0.4"/>
                </Border.Effect>

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Custom Title Bar -->
                    <Border Grid.Row="0" 
                            Background="{StaticResource CardBackgroundBrush}" 
                            MouseLeftButtonDown="TitleBar_MouseLeftButtonDown"
                            Height="32"
                            CornerRadius="8,8,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" 
                                      Orientation="Horizontal"
                                      Margin="12,0,0,0"
                                      VerticalAlignment="Center">
                                <TextBlock Text="DEEP" 
                                          FontSize="15" 
                                          FontWeight="ExtraBold"
                                          FontFamily="{StaticResource Rubik}"
                                          Foreground="{StaticResource AccentBrush}">
                                    <TextBlock.Effect>
                                        <DropShadowEffect Color="{StaticResource AccentColor}" Direction="0" ShadowDepth="0" BlurRadius="15" Opacity="0.6"/>
                                    </TextBlock.Effect>
                                    
                                </TextBlock>

                                <TextBlock Text="INJECTOR" 
                                          FontSize="15" 
                                          Margin="4,0,0,0"
                                          FontWeight="ExtraBold"
                                          FontFamily="{StaticResource Rubik}"
                                          Foreground="White"
                                          Opacity="0.8"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2" 
                                      Orientation="Horizontal"
                                      HorizontalAlignment="Right">
                                <Button x:Name="MinimizeButton" 
                                      Content="➖" 
                                      Click="MinimizeButton_Click"
                                      Style="{StaticResource TitleBarButton}"
                                      Foreground="White"/>
                                <Button x:Name="CloseButton" 
                                      Content="❌" 
                                      Click="CloseButton_Click"
                                      Style="{StaticResource CloseButton}"
                                      Foreground="White"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Content Area -->
                    <ContentPresenter Grid.Row="1" Content="{TemplateBinding Content}"/>

                </Grid>
            </Border>
        </ControlTemplate>
    </Window.Template>

    <!-- Main Content -->
    <Grid Margin="0">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="4.5*"/>
                <ColumnDefinition Width="7*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel - DLL List -->
            <Border Grid.Column="0"
                    Style="{StaticResource GlassCard}"
                    Margin="0,0,0,0"
                    Padding="15, 15, 0, 15">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" 
                               Text="Add DLL" 
                               FontSize="16" 
                               FontWeight="Bold" 
                               Margin="0,0,0,4"/>

                    <Border Grid.Row="1" 
                            x:Name="DllListBoxBorder"
                            BorderBrush="{StaticResource GlassBorderBrush}" 
                            BorderThickness="0" 
                            CornerRadius="6" 
                            Margin="0,0,0,12"
                            Background="#10FFFFFF">
                        <ListBox x:Name="DllListBox" 
         Style="{StaticResource GlassListBox}"
         BorderThickness="0"
         Background="Transparent"
         SelectionMode="Single"
         SelectionChanged="DllListBox_SelectionChanged"
         ItemContainerStyle="{StaticResource GlassListBoxItem}"
         ItemTemplate="{StaticResource DllItemTemplate}"
         Padding="4"
         AllowDrop="True"
         Drop="DllListBox_Drop"
         DragOver="DllListBox_DragOver"
         DragEnter="DllListBox_DragEnter"
         DragLeave="DllListBox_DragLeave"
         ScrollViewer.CanContentScroll="False"
         ScrollViewer.VerticalScrollBarVisibility="Auto"
         ScrollViewer.HorizontalScrollBarVisibility="Disabled"/>

                    </Border>

                    <Grid Grid.Row="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="0"
                                x:Name="AddDllButton" 
                                Click="AddDllButton_Click" 
                                FontSize="14"
                                Content="Add DLL" 
                                Style="{StaticResource GlassAccentButton}"
                                Height="32"
                                Margin="0,0,4,0"/>

                        <Button Grid.Column="1"
                                x:Name="RemoveDllButton" 
                                Click="RemoveDllButton_Click" 
                                Content="Remove" 
                                FontSize="14"
                                Height="32"
                                Style="{StaticResource GlassButton}"
                                Margin="4,0,0,0"
                                IsEnabled="{Binding ElementName=DllListBox, Path=SelectedItem, Converter={StaticResource NullToBoolConverter}}"/>
                    </Grid>
                </Grid>
            </Border>

            <!-- Right Panel - Injection Controls -->
            <Border Grid.Column="1"
                    Style="{StaticResource GlassCard}"
                    Margin="0,0,0,0"
                    Padding="15, 15, 15, 15">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"></ColumnDefinition>
                        <ColumnDefinition Width="30"></ColumnDefinition>
                    </Grid.ColumnDefinitions>


                    <TextBlock Grid.Row="0" 
                               Grid.ColumnSpan="2"
                               FontSize="14"
                               Text="Target Process"
                               FontWeight="SemiBold"
                               Margin="0,0,0,6"/>

                    <ComboBox Grid.Row="1" 
                              x:Name="ProcessComboBox" 
                              IsEditable="True" 
                              Style="{StaticResource GlassComboBox}"
                              Margin="0,0,0,10"
                              FontSize="12"
                              Height="32"
                              IsTextSearchEnabled="True"
                              StaysOpenOnEdit="False"
                              IsTabStop="True"
                              Focusable="True"
                              TextBoxBase.TextChanged="ProcessComboBox_TextChanged"
                              ItemTemplate="{StaticResource ProcessItemTemplate}"
                              TextSearch.TextPath="Name"
                              IsDropDownOpen="{Binding IsComboBoxOpen, Mode=TwoWay}"
                              IsHitTestVisible="True"
                              Cursor="Hand"/>

                    <Button Grid.Row="1"
                            Grid.Column="1"
                            x:Name="RefreshButton" 
                            Content="⟳" 
                            Click="RefreshButton_Click" 
                            Style="{StaticResource GlassButton}"
                            HorizontalAlignment="Right" 
                            VerticalAlignment="Top"
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center"
                            Margin="0,4,0,0"
                            FontSize="18"
                            Padding="4,0,4,0"/>

                    <Border Grid.Row="2" 
                            Grid.ColumnSpan="2"
                            Style="{StaticResource GlassPanel}"
                            Margin="0,0,0,12">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" 
                                       Text="Selected DLL" 
                                       FontWeight="ExtraBold" 
                                       FontSize="14" 
                                       Margin="0,0,0,10"
                                       Foreground="{StaticResource AccentBrush}"/>

                            <ScrollViewer Grid.Row="1"
                                          VerticalScrollBarVisibility="Auto"
                                          HorizontalScrollBarVisibility="Disabled"
                                          MaxHeight="55">
                                <TextBlock Grid.Row="1" 
                                       x:Name="SelectedDllPathTextBlock" 
                                       Text="No DLL selected" 
                                       FontSize="12"
                                       TextWrapping="Wrap"/>
                            </ScrollViewer>
                        </Grid>
                    </Border>

                    <Button Grid.Row="3" 
                            Grid.ColumnSpan="2"
                            x:Name="InjectButton" 
                            Content="INJECT" 
                            Click="InjectButton_Click" 
                            Style="{StaticResource GlassAccentButton}" 
                            Height="50" 
                            FontSize="18" 
                            FontWeight="Bold"
                            IsEnabled="False"/>
                </Grid>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="1" 
                Style="{StaticResource StatusPanel}"
                Margin="0,0,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="STATUS"
                           Foreground="{StaticResource AccentBrush}"
                           FontWeight="Bold"
                           FontSize="12"
                           Margin="0,0,10,0"/>

                <TextBlock Grid.Column="1"
                           x:Name="StatusTextBlock" 
                           FontSize="12"
                           Text="Ready"
                           TextTrimming="CharacterEllipsis"/>
            </Grid>
        </Border>
    </Grid>
</Window>
